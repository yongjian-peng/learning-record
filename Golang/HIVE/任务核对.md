#### 
#### HIVE 核对
```
WITH
  origin AS (
    SELECT
      `amount_info` as `amount_info`,
      `amount` as `amount`,
      `app_id` as `app_id`,
      `biz_order_no` as `biz_order_no`,
      `channel_app_id` as `channel_app_id`,
      `channel_code` as `channel_code`,
      `channel_finish_time` as `channel_finish_time`,
      `channel_merchant_id` as `channel_merchant_id`,
      `channel_order_id` as `channel_order_id`,
      `channel_order_no` as `channel_order_no`,
      `channel_sub_merchant_id` as `channel_sub_merchant_id`,
      `channel_type` as `channel_type`,
      `currency` as `currency`,
      `date` as `date`,
      `extension` as `extension`,
      `gmt_created` as `gmt_created`,
      `gmt_modified` as `gmt_modified`,
      `id` as `id`,
      `merchant_id` as `merchant_id`,
      `method` as `method`,
      `out_channel_finish_time` as `out_channel_finish_time`,
      `out_channel_order_no` as `out_channel_order_no`,
      `out_channel_resp_code` as `out_channel_resp_code`,
      `out_channel_resp_msg` as `out_channel_resp_msg`,
      `out_uniq_key` as `out_uniq_key`,
      `pay_order_no` as `pay_order_no`,
      `pd_code` as `pd_code`,
      `resp_code` as `resp_code`,
      `resp_msg` as `resp_msg`,
      `resp_sub_code` as `resp_sub_code`,
      `resp_sub_msg` as `resp_sub_msg`,
      `sharding_key` as `sharding_key`,
      `status` as `status`,
      `sub_pay_type` as `sub_pay_type`,
      `trade_desc` as `trade_desc`,
      `trade_order_no` as `trade_order_no`,
      `version` as `version`
    FROM
      caijing_dw_ddl.dwd_pcs_channel_payment_channel_pay_df
    WHERE
      date = '20240905'
      AND status = "SUCCESS"
      AND channel_type = 'TLPAY'
      AND channel_code in ('TLPAY_1002')
      AND method = 'Pay'
      AND channel_finish_time >= 1725465600
      AND channel_finish_time < 1725552000
  ),
  dest AS (
    SELECT
      `accoun_iden` as `accoun_iden`,
      `addtnl_data` as `addtnl_data`,
      `agree_signing` as `agree_signing`,
      CAST(amt_tran AS DECIMAL(20, 2)) as `amountInCent`,
      `amt_tran` as `amt_tran`,
      CASE cur_type
        WHEN '156' THEN 'CNY'
        ELSE ''
      END as `cur_type_change`,
      `cur_type` as `cur_type`,
      `date_settlmt` as `date_settlmt`,
      `date` as `date`,
      `order_num` as `order_num`,
      `org_req_trace_num` as `org_req_trace_num`,
      `org_trans_date` as `org_trans_date`,
      `pay_amount` as `pay_amount`,
      `pay_mode` as `pay_mode`,
      `processing_code` as `processing_code`,
      `promotion_fee` as `promotion_fee`,
      `req_trace_num` as `req_trace_num`,
      `resp_code` as `resp_code`,
      `resp_msg` as `resp_msg`,
      `trace_fee` as `trace_fee`,
      `trade_fee` as `trade_fee`,
      `trans_date` as `trans_date`
    FROM
      caijing_pay.ods_channel_bank_allin_trans
    WHERE
      date = '20240905'
      AND resp_code = "0000"
      AND processing_code = "2085"
  ),
  multi_view AS (
    SELECT
      origin.amount as origin_amount,
      origin.amount_info as origin_amount_info,
      origin.app_id as origin_app_id,
      origin.biz_order_no as origin_biz_order_no,
      origin.channel_app_id as origin_channel_app_id,
      origin.channel_code as origin_channel_code,
      origin.channel_finish_time as origin_channel_finish_time,
      origin.channel_merchant_id as origin_channel_merchant_id,
      origin.channel_order_id as origin_channel_order_id,
      origin.channel_order_no as origin_channel_order_no,
      origin.channel_sub_merchant_id as origin_channel_sub_merchant_id,
      origin.channel_type as origin_channel_type,
      origin.currency as origin_currency,
      origin.date as origin_date,
      origin.extension as origin_extension,
      origin.gmt_created as origin_gmt_created,
      origin.gmt_modified as origin_gmt_modified,
      origin.id as origin_id,
      origin.merchant_id as origin_merchant_id,
      origin.method as origin_method,
      origin.out_channel_finish_time as origin_out_channel_finish_time,
      origin.out_channel_order_no as origin_out_channel_order_no,
      origin.out_channel_resp_code as origin_out_channel_resp_code,
      origin.out_channel_resp_msg as origin_out_channel_resp_msg,
      origin.out_uniq_key as origin_out_uniq_key,
      origin.pay_order_no as origin_pay_order_no,
      origin.pd_code as origin_pd_code,
      origin.resp_code as origin_resp_code,
      origin.resp_msg as origin_resp_msg,
      origin.resp_sub_code as origin_resp_sub_code,
      origin.resp_sub_msg as origin_resp_sub_msg,
      origin.sharding_key as origin_sharding_key,
      origin.status as origin_status,
      origin.sub_pay_type as origin_sub_pay_type,
      origin.trade_desc as origin_trade_desc,
      origin.trade_order_no as origin_trade_order_no,
      origin.version as origin_version,
      dest.accoun_iden as dest_accoun_iden,
      dest.addtnl_data as dest_addtnl_data,
      dest.agree_signing as dest_agree_signing,
      dest.amountInCent as dest_amountInCent,
      dest.amt_tran as dest_amt_tran,
      dest.cur_type as dest_cur_type,
      dest.cur_type_change as dest_cur_type_change,
      dest.date as dest_date,
      dest.date_settlmt as dest_date_settlmt,
      dest.order_num as dest_order_num,
      dest.org_req_trace_num as dest_org_req_trace_num,
      dest.org_trans_date as dest_org_trans_date,
      dest.pay_amount as dest_pay_amount,
      dest.pay_mode as dest_pay_mode,
      dest.processing_code as dest_processing_code,
      dest.promotion_fee as dest_promotion_fee,
      dest.req_trace_num as dest_req_trace_num,
      dest.resp_code as dest_resp_code,
      dest.resp_msg as dest_resp_msg,
      dest.trace_fee as dest_trace_fee,
      dest.trade_fee as dest_trade_fee,
      dest.trans_date as dest_trans_date
    FROM
      origin
      FULL JOIN dest ON (origin.channel_order_no = dest.req_trace_num)
  )
SELECT
  '240822170527317527588698' as task_code,
  CASE
    WHEN origin_channel_order_no is not null THEN origin_channel_order_no
    WHEN dest_req_trace_num is not null THEN dest_req_trace_num
  END as recon_no,
  '202304031126458579175425' as origin_data_code,
  'DG240822172442458295623681' as dest_data_code,
  origin_channel_order_no as origin_recon_no,
  dest_req_trace_num as dest_recon_no,
  to_json (
    named_struct (
      'amount',
      origin_amount,
      'amount_info',
      origin_amount_info,
      'app_id',
      origin_app_id,
      'biz_order_no',
      origin_biz_order_no,
      'channel_app_id',
      origin_channel_app_id,
      'channel_code',
      origin_channel_code,
      'channel_finish_time',
      origin_channel_finish_time,
      'channel_merchant_id',
      origin_channel_merchant_id,
      'channel_order_id',
      origin_channel_order_id,
      'channel_order_no',
      origin_channel_order_no,
      'channel_sub_merchant_id',
      origin_channel_sub_merchant_id,
      'channel_type',
      origin_channel_type,
      'currency',
      origin_currency,
      'date',
      origin_date,
      'extension',
      origin_extension,
      'gmt_created',
      origin_gmt_created,
      'gmt_modified',
      origin_gmt_modified,
      'id',
      origin_id,
      'merchant_id',
      origin_merchant_id,
      'method',
      origin_method,
      'out_channel_finish_time',
      origin_out_channel_finish_time,
      'out_channel_order_no',
      origin_out_channel_order_no,
      'out_channel_resp_code',
      origin_out_channel_resp_code,
      'out_channel_resp_msg',
      origin_out_channel_resp_msg,
      'out_uniq_key',
      origin_out_uniq_key,
      'pay_order_no',
      origin_pay_order_no,
      'pd_code',
      origin_pd_code,
      'resp_code',
      origin_resp_code,
      'resp_msg',
      origin_resp_msg,
      'resp_sub_code',
      origin_resp_sub_code,
      'resp_sub_msg',
      origin_resp_sub_msg,
      'sharding_key',
      origin_sharding_key,
      'status',
      origin_status,
      'sub_pay_type',
      origin_sub_pay_type,
      'trade_desc',
      origin_trade_desc,
      'trade_order_no',
      origin_trade_order_no,
      'version',
      origin_version
    )
  ) as origin_recon_content,
  to_json (
    named_struct (
      'accoun_iden',
      dest_accoun_iden,
      'addtnl_data',
      dest_addtnl_data,
      'agree_signing',
      dest_agree_signing,
      'amountInCent',
      dest_amountInCent,
      'amt_tran',
      dest_amt_tran,
      'cur_type',
      dest_cur_type,
      'cur_type_change',
      dest_cur_type_change,
      'date',
      dest_date,
      'date_settlmt',
      dest_date_settlmt,
      'order_num',
      dest_order_num,
      'org_req_trace_num',
      dest_org_req_trace_num,
      'org_trans_date',
      dest_org_trans_date,
      'pay_amount',
      dest_pay_amount,
      'pay_mode',
      dest_pay_mode,
      'processing_code',
      dest_processing_code,
      'promotion_fee',
      dest_promotion_fee,
      'req_trace_num',
      dest_req_trace_num,
      'resp_code',
      dest_resp_code,
      'resp_msg',
      dest_resp_msg,
      'trace_fee',
      dest_trace_fee,
      'trade_fee',
      dest_trade_fee,
      'trans_date',
      dest_trans_date
    )
  ) as dest_recon_content,
  CASE
    WHEN origin_channel_order_no is null THEN 'OriginLess'
    WHEN dest_req_trace_num is null THEN 'DestLess'
    WHEN NOT (origin_amount = dest_amountInCent) THEN 'AmountDiff'
    WHEN NOT (origin_currency = dest_cur_type_change) THEN 'CurrencyDiff'
    ELSE 'PASS'
  END AS mistake_type,
  CASE
    WHEN origin_channel_order_no is null THEN 'Default'
    WHEN dest_req_trace_num is null THEN 'Default'
    WHEN NOT (origin_amount = dest_amountInCent) THEN '202408221739433284972545'
    WHEN NOT (origin_currency = dest_cur_type_change) THEN '202408261121493284972545'
    ELSE 'Default'
  END AS recon_rule_id,
  CASE
    WHEN origin_channel_order_no is null THEN 'Default'
    WHEN dest_req_trace_num is null THEN 'Default'
    WHEN NOT (origin_amount = dest_amountInCent) THEN "origin_amount==dest_amountInCent"
    WHEN NOT (origin_currency = dest_cur_type_change) THEN "origin_currency==dest_cur_type_change"
    ELSE 'Default'
  END AS recon_rule_express,
  'Hive' AS recon_handle_type
FROM
  multi_view
WHERE
  NOT (
    (origin_amount = dest_amountInCent)
    AND (origin_currency = dest_cur_type_change)
  )
  OR (
    origin_channel_order_no IS NULL
    OR dest_req_trace_num IS NULL
  )
limit
  1000001
```

#### HIVE表创建
```
CREATE TABLE
  caijing_pay.ods_channel_bank_allin_trans (
    req_trace_num STRING COMMENT '申请方流水号',
    order_num STRING COMMENT '受理方流水号',
    trans_date STRING COMMENT '交易日期',
    processing_code STRING COMMENT '交易类型',
    cur_type STRING COMMENT '交易币种',
    amt_tran STRING COMMENT '交易金额',
    promotion_fee STRING COMMENT '营销金额',
    pay_mode STRING COMMENT '支付模式',
    accoun_iden STRING COMMENT '购买/还款类型',
    org_req_trace_num STRING COMMENT '原申请方交易流水号',
    org_trans_date STRING COMMENT '原交易日期',
    date_settlmt STRING COMMENT '交易工作日', 
    agree_signing STRING COMMENT '协议签约号',  
    pay_amount STRING COMMENT '支付金额',  
    trace_fee STRING COMMENT '分润金额',  
    trade_fee STRING COMMENT '通联手续费金额',  
    resp_code STRING COMMENT '交易返回码',  
    resp_msg STRING COMMENT '交易返回码信息',
    addtnl_data STRING COMMENT '附加信息'
  ) PARTITIONED BY (date STRING COMMENT '时间分区') 
```

#### 退款
```
WITH
  origin AS (
    SELECT
      `amount_info` as `amount_info`,
      `amount` as `amount`,
      `app_id` as `app_id`,
      `biz_refund_order_no` as `biz_refund_order_no`,
      `channel_app_id` as `channel_app_id`,
      `channel_code` as `channel_code`,
      `channel_finish_time` as `channel_finish_time`,
      `channel_merchant_id` as `channel_merchant_id`,
      `channel_refund_order_id` as `channel_refund_order_id`,
      `channel_refund_order_no` as `channel_refund_order_no`,
      `channel_sub_merchant_id` as `channel_sub_merchant_id`,
      `channel_type` as `channel_type`,
      `currency` as `currency`,
      `date` as `date`,
      `extension` as `extension`,
      `gmt_created` as `gmt_created`,
      `gmt_modified` as `gmt_modified`,
      `id` as `id`,
      `merchant_id` as `merchant_id`,
      `method` as `method`,
      `out_channel_finish_time` as `out_channel_finish_time`,
      `out_channel_refund_order_no` as `out_channel_refund_order_no`,
      `out_channel_resp_code` as `out_channel_resp_code`,
      `out_channel_resp_msg` as `out_channel_resp_msg`,
      `pay_refund_order_no` as `pay_refund_order_no`,
      `pd_code` as `pd_code`,
      `resp_code` as `resp_code`,
      `resp_msg` as `resp_msg`,
      `resp_sub_code` as `resp_sub_code`,
      `resp_sub_msg` as `resp_sub_msg`,
      `sharding_key` as `sharding_key`,
      `src_channel_order_id` as `src_channel_order_id`,
      `src_channel_order_no` as `src_channel_order_no`,
      `status` as `status`,
      `trade_desc` as `trade_desc`,
      `trade_refund_order_no` as `trade_refund_order_no`,
      `version` as `version`
    FROM
      caijing_dw_ddl.dwd_pcs_channel_payment_channel_refund_df
    WHERE
      date = '20240905'
      AND status = "SUCCESS"
      AND channel_type = 'TLPAY'
      AND channel_code in ('TLPAY_1002')
      AND channel_finish_time >= 1725465600
      AND channel_finish_time < 1725552000
  ),
  dest AS (
    SELECT
      `accoun_iden` as `accoun_iden`,
      `addtnl_data` as `addtnl_data`,
      `agree_signing` as `agree_signing`,
      CAST(amt_tran AS DECIMAL(20, 2)) as `amountInCent`,
      `amt_tran` as `amt_tran`,
      CASE cur_type
        WHEN '156' THEN 'CNY'
        ELSE ''
      END as `cur_type_change`,
      `cur_type` as `cur_type`,
      `date_settlmt` as `date_settlmt`,
      `date` as `date`,
      `order_num` as `order_num`,
      `org_req_trace_num` as `org_req_trace_num`,
      `org_trans_date` as `org_trans_date`,
      `pay_amount` as `pay_amount`,
      `pay_mode` as `pay_mode`,
      `processing_code` as `processing_code`,
      `promotion_fee` as `promotion_fee`,
      `req_trace_num` as `req_trace_num`,
      `resp_code` as `resp_code`,
      `resp_msg` as `resp_msg`,
      `trace_fee` as `trace_fee`,
      `trade_fee` as `trade_fee`,
      `trans_date` as `trans_date`
    FROM
      caijing_pay.ods_channel_bank_allin_trans
    WHERE
      date = '20240905'
      AND resp_code = "0000"
      AND processing_code = "2294"
  ),
  multi_view AS (
    SELECT
      origin.amount as origin_amount,
      origin.amount_info as origin_amount_info,
      origin.app_id as origin_app_id,
      origin.biz_refund_order_no as origin_biz_refund_order_no,
      origin.channel_app_id as origin_channel_app_id,
      origin.channel_code as origin_channel_code,
      origin.channel_finish_time as origin_channel_finish_time,
      origin.channel_merchant_id as origin_channel_merchant_id,
      origin.channel_refund_order_id as origin_channel_refund_order_id,
      origin.channel_refund_order_no as origin_channel_refund_order_no,
      origin.channel_sub_merchant_id as origin_channel_sub_merchant_id,
      origin.channel_type as origin_channel_type,
      origin.currency as origin_currency,
      origin.date as origin_date,
      origin.extension as origin_extension,
      origin.gmt_created as origin_gmt_created,
      origin.gmt_modified as origin_gmt_modified,
      origin.id as origin_id,
      origin.merchant_id as origin_merchant_id,
      origin.method as origin_method,
      origin.out_channel_finish_time as origin_out_channel_finish_time,
      origin.out_channel_refund_order_no as origin_out_channel_refund_order_no,
      origin.out_channel_resp_code as origin_out_channel_resp_code,
      origin.out_channel_resp_msg as origin_out_channel_resp_msg,
      origin.pay_refund_order_no as origin_pay_refund_order_no,
      origin.pd_code as origin_pd_code,
      origin.resp_code as origin_resp_code,
      origin.resp_msg as origin_resp_msg,
      origin.resp_sub_code as origin_resp_sub_code,
      origin.resp_sub_msg as origin_resp_sub_msg,
      origin.sharding_key as origin_sharding_key,
      origin.src_channel_order_id as origin_src_channel_order_id,
      origin.src_channel_order_no as origin_src_channel_order_no,
      origin.status as origin_status,
      origin.trade_desc as origin_trade_desc,
      origin.trade_refund_order_no as origin_trade_refund_order_no,
      origin.version as origin_version,
      dest.accoun_iden as dest_accoun_iden,
      dest.addtnl_data as dest_addtnl_data,
      dest.agree_signing as dest_agree_signing,
      dest.amountInCent as dest_amountInCent,
      dest.amt_tran as dest_amt_tran,
      dest.cur_type as dest_cur_type,
      dest.cur_type_change as dest_cur_type_change,
      dest.date as dest_date,
      dest.date_settlmt as dest_date_settlmt,
      dest.order_num as dest_order_num,
      dest.org_req_trace_num as dest_org_req_trace_num,
      dest.org_trans_date as dest_org_trans_date,
      dest.pay_amount as dest_pay_amount,
      dest.pay_mode as dest_pay_mode,
      dest.processing_code as dest_processing_code,
      dest.promotion_fee as dest_promotion_fee,
      dest.req_trace_num as dest_req_trace_num,
      dest.resp_code as dest_resp_code,
      dest.resp_msg as dest_resp_msg,
      dest.trace_fee as dest_trace_fee,
      dest.trade_fee as dest_trade_fee,
      dest.trans_date as dest_trans_date
    FROM
      origin
      FULL JOIN dest ON (
        origin.channel_refund_order_no = dest.req_trace_num
      )
  )
SELECT
  '240822170527317531678850' as task_code,
  CASE
    WHEN origin_channel_refund_order_no is not null THEN origin_channel_refund_order_no
    WHEN dest_req_trace_num is not null THEN dest_req_trace_num
  END as recon_no,
  '202304041955468579175425' as origin_data_code,
  'DG240822172442458295623681' as dest_data_code,
  origin_channel_refund_order_no as origin_recon_no,
  dest_req_trace_num as dest_recon_no,
  to_json (
    named_struct (
      'amount',
      origin_amount,
      'amount_info',
      origin_amount_info,
      'app_id',
      origin_app_id,
      'biz_refund_order_no',
      origin_biz_refund_order_no,
      'channel_app_id',
      origin_channel_app_id,
      'channel_code',
      origin_channel_code,
      'channel_finish_time',
      origin_channel_finish_time,
      'channel_merchant_id',
      origin_channel_merchant_id,
      'channel_refund_order_id',
      origin_channel_refund_order_id,
      'channel_refund_order_no',
      origin_channel_refund_order_no,
      'channel_sub_merchant_id',
      origin_channel_sub_merchant_id,
      'channel_type',
      origin_channel_type,
      'currency',
      origin_currency,
      'date',
      origin_date,
      'extension',
      origin_extension,
      'gmt_created',
      origin_gmt_created,
      'gmt_modified',
      origin_gmt_modified,
      'id',
      origin_id,
      'merchant_id',
      origin_merchant_id,
      'method',
      origin_method,
      'out_channel_finish_time',
      origin_out_channel_finish_time,
      'out_channel_refund_order_no',
      origin_out_channel_refund_order_no,
      'out_channel_resp_code',
      origin_out_channel_resp_code,
      'out_channel_resp_msg',
      origin_out_channel_resp_msg,
      'pay_refund_order_no',
      origin_pay_refund_order_no,
      'pd_code',
      origin_pd_code,
      'resp_code',
      origin_resp_code,
      'resp_msg',
      origin_resp_msg,
      'resp_sub_code',
      origin_resp_sub_code,
      'resp_sub_msg',
      origin_resp_sub_msg,
      'sharding_key',
      origin_sharding_key,
      'src_channel_order_id',
      origin_src_channel_order_id,
      'src_channel_order_no',
      origin_src_channel_order_no,
      'status',
      origin_status,
      'trade_desc',
      origin_trade_desc,
      'trade_refund_order_no',
      origin_trade_refund_order_no,
      'version',
      origin_version
    )
  ) as origin_recon_content,
  to_json (
    named_struct (
      'accoun_iden',
      dest_accoun_iden,
      'addtnl_data',
      dest_addtnl_data,
      'agree_signing',
      dest_agree_signing,
      'amountInCent',
      dest_amountInCent,
      'amt_tran',
      dest_amt_tran,
      'cur_type',
      dest_cur_type,
      'cur_type_change',
      dest_cur_type_change,
      'date',
      dest_date,
      'date_settlmt',
      dest_date_settlmt,
      'order_num',
      dest_order_num,
      'org_req_trace_num',
      dest_org_req_trace_num,
      'org_trans_date',
      dest_org_trans_date,
      'pay_amount',
      dest_pay_amount,
      'pay_mode',
      dest_pay_mode,
      'processing_code',
      dest_processing_code,
      'promotion_fee',
      dest_promotion_fee,
      'req_trace_num',
      dest_req_trace_num,
      'resp_code',
      dest_resp_code,
      'resp_msg',
      dest_resp_msg,
      'trace_fee',
      dest_trace_fee,
      'trade_fee',
      dest_trade_fee,
      'trans_date',
      dest_trans_date
    )
  ) as dest_recon_content,
  CASE
    WHEN origin_channel_refund_order_no is null THEN 'OriginLess'
    WHEN dest_req_trace_num is null THEN 'DestLess'
    WHEN NOT (origin_amount = dest_amountInCent) THEN 'AmountDiff'
    ELSE 'PASS'
  END AS mistake_type,
  CASE
    WHEN origin_channel_refund_order_no is null THEN 'Default'
    WHEN dest_req_trace_num is null THEN 'Default'
    WHEN NOT (origin_amount = dest_amountInCent) THEN '202408221901153284972545'
    ELSE 'Default'
  END AS recon_rule_id,
  CASE
    WHEN origin_channel_refund_order_no is null THEN 'Default'
    WHEN dest_req_trace_num is null THEN 'Default'
    WHEN NOT (origin_amount = dest_amountInCent) THEN "origin_amount==dest_amountInCent"
    ELSE 'Default'
  END AS recon_rule_express,
  'Hive' AS recon_handle_type
FROM
  multi_view
WHERE
  NOT ((origin_amount = dest_amountInCent))
  OR (
    origin_channel_refund_order_no IS NULL
    OR dest_req_trace_num IS NULL
  )
limit
  1000001
```

#### 写HIVE
```
INSERT OVERWRITE TABLE caijing_check_recon.caijing_pay_channel_batch_extension PARTITION(batch_no = "${date}00", channel_merchant_id = '1667248769')
-- 交易
SELECT  (
            CASE WHEN trade_status = 'SUCCESS' THEN merchant_order_no
                 WHEN trade_status = 'REFUND' THEN merchant_refund_order_no
                 ELSE ''
            END
        ) AS channel_order_no,
        (
            CASE WHEN trade_status = 'SUCCESS' THEN wechat_order_no
                 WHEN trade_status = 'REFUND' THEN wechat_refund_order_no
                 ELSE ''
            END
        ) AS trade_flow_no,
        (CASE WHEN trade_status = 'REFUND' THEN wechat_order_no ELSE '' END) AS ori_trade_flow_no,
        CAST(
            CAST(
                (
                    CASE WHEN trade_status = 'SUCCESS' THEN order_bmount
                         WHEN trade_status = 'REFUND' THEN refund_amount
                         ELSE ''
                    END
                ) AS DECIMAL(20, 2)
            ) * 100 AS BIGINT
        ) AS trade_amount,
        'CNY' AS currency,
        (
            CASE WHEN trade_status = 'SUCCESS' THEN 'Collection'
                 WHEN trade_status = 'REFUND' THEN 'Refund'
                 ELSE 'UNKNOWN'
            END
        ) AS trade_type,
        (
            CASE WHEN trade_status = 'SUCCESS' THEN 'SUCCESS'
                 WHEN trade_status = 'REFUND' THEN 'REFUND'
                 ELSE ''
            END
        ) AS trade_status,
        UNIX_TIMESTAMP(trade_time, 'yyyy-MM-dd HH:mm:ss') AS out_channel_finish_time,
        '' AS channel_code,
        '{}' AS extension
FROM    caijing_pay.t_channel_wxpay_bill_day
WHERE   merchant_no = '1667248769'
AND     trade_status IN('SUCCESS', 'REFUND')
AND     date = '${date}'
UNION ALL
-- 手续费
SELECT  (
            CASE WHEN trade_status = 'SUCCESS' THEN merchant_order_no
                 WHEN trade_status = 'REFUND' THEN merchant_refund_order_no
                 ELSE ''
            END
        ) AS channel_order_no,
        (
            CASE WHEN trade_status = 'SUCCESS' THEN wechat_order_no
                 WHEN trade_status = 'REFUND' THEN wechat_refund_order_no
                 ELSE ''
            END
        ) AS trade_flow_no,
        (CASE WHEN trade_status = 'REFUND' THEN wechat_order_no ELSE '' END) AS ori_trade_flow_no,
        (
            CASE WHEN trade_status = 'REFUND' THEN -1
                 ELSE 1
            END
        ) * CAST(CAST(fee AS DECIMAL(20, 5)) * 100 AS BIGINT) AS trade_amount,
        'CNY' AS currency,
        (
            CASE WHEN trade_status = 'SUCCESS' THEN 'CollectionFee'
                 WHEN trade_status = 'REFUND' THEN 'RefundFee'
                 ELSE 'UNKNOWN'
            END
        ) AS trade_type,
        (
            CASE WHEN trade_status = 'SUCCESS' THEN 'SUCCESS'
                 WHEN trade_status = 'REFUND' THEN 'REFUND'
                 ELSE ''
            END
        ) AS trade_status,
        UNIX_TIMESTAMP(trade_time, 'yyyy-MM-dd HH:mm:ss') AS out_channel_finish_time,
        '' AS channel_code,
        '{}' AS extension
FROM    caijing_pay.t_channel_wxpay_bill_day
WHERE   merchant_no = '1667248769'
AND     trade_status IN('SUCCESS', 'REFUND')
AND     date = '${date}';

```

#### 写HIVE 支付宝
```
 set hive.exec.dynamic.partition=true;
 set hive.exec.dynamic.partition.mode=nonstrict;
INSERT OVERWRITE TABLE caijing_check_recon.caijing_pay_channel_batch_extension PARTITION(channel_merchant_id,batch_no)
-- 交易
SELECT  (
            CASE WHEN business_type = '交易' THEN merchant_no
                 WHEN business_type = '退款' THEN refund_or_request_no
                 ELSE ''
            END
        ) AS channel_order_no,
        channel_no AS trade_flow_no,
        (CASE WHEN business_type = '退款' THEN channel_no ELSE '' END) AS ori_trade_flow_no,
        (
            CASE WHEN business_type = '退款' THEN -1
                 ELSE 1
            END
        ) * CAST(CAST(order_amount AS DECIMAL(20, 2)) * 100 AS BIGINT) AS trade_amount,
        'CNY' AS currency,
        (
            CASE WHEN business_type = '交易' THEN 'Collection'
                 WHEN business_type = '退款' THEN 'Refund'
                 ELSE 'UNKNOWN'
            END
        ) AS trade_type,
        'SUCCESS' AS trade_status,
        UNIX_TIMESTAMP(finish_time, 'yyyy-MM-dd HH:mm:ss') AS out_channel_finish_time,
        '' AS channel_code,
        '{}' AS extension,
        SUBSTRING(merchant_id_no, 1, LENGTH(merchant_id_no) - 4) AS merchant_no,
        '${date}00' as batch_no
FROM    caijing_pay.t_channel_alipay_trade_business_day
WHERE   merchant_id_no in('20887413280446050156','20881415582603090156')
AND     business_type IN('交易','退款')
AND     date = '${date}'
UNION ALL
-- 手续费
SELECT  (
            CASE WHEN business_type = '交易' THEN merchant_no
                 WHEN business_type = '退款' THEN refund_or_request_no
                 ELSE ''
            END
        ) AS channel_order_no,
        channel_no AS trade_flow_no,
        (CASE WHEN business_type = '退款' THEN channel_no ELSE '' END) AS ori_trade_flow_no,
        (
            CASE WHEN business_type = '交易' THEN -1
                 ELSE 1
            END
        ) * CAST(CAST(fee AS DECIMAL(20, 5)) * 100 AS BIGINT) AS trade_amount,
        'CNY' AS currency,
        (
            CASE WHEN business_type = '交易' THEN 'CollectionFee'
                 WHEN business_type = '退款' THEN 'RefundFee'
                 ELSE 'UNKNOWN'
            END
        ) AS trade_type,
        'SUCCESS' AS trade_status,
        UNIX_TIMESTAMP(finish_time, 'yyyy-MM-dd HH:mm:ss') AS out_channel_finish_time,
        '' AS channel_code,
        '{}' AS extension,
        SUBSTRING(merchant_id_no, 1, LENGTH(merchant_id_no) - 4) AS merchant_no,
        '${date}00' as batch_no
FROM    caijing_pay.t_channel_alipay_trade_business_day
WHERE   merchant_id_no in('20887413280446050156','20881415582603090156')
AND     business_type IN('交易','退款')
AND     date = '${date}';
```
