### 串口收发函数

#### 总体思路
```
总体程序设计思路
    串口初始化函数
    发送一个字节函数
    接收一个字节函数

详细程序设计思路（每个函数里面应该怎么写程序）
    初始化函数
    {
        // GPIO 初始化
        // 端口时钟使能
        // 选择端口模式寄存器(复用)
        // 输出速度寄存器
        // 输出类型寄存器
        // 上下拉选择
        // 复用功能寄存器

        // 串口初始化
        // 控制器使能打开
        // 波特率寄存器设置
        // 控制寄存器过采样
        // 控制寄存器字长
        // 控制寄存器发送使能
        // 控制寄存器接收使能
        // 控制寄存器停止位
        // 控制寄存器使能打开

    }
```

#### 发送函数
```
    发送一个字节函数
    {
        // 等待发送一个字节已完成（发送寄存器已自动置1）
        // 将发送的一个字节赋值给数据寄存器
        
        // 发送状态寄存器
        // 接收状态寄存器
    }

    u8 接收一个字节函数
    {
        // 等待接收一个字节已完成（接收寄存器已自动置1）
        // 读取接数据存器的值赋值给变量
        // 返回接收值
    }
```


#### 相关函数
```

u8 str[] = "Hello World \r\n";

// 发送一个字符串函数
无返回值
void usart1_send_str(u8 *str)
{
    while(*str != '\0')
    {
        usart1_send_byte(*str);
        str++;
    }
}

u8 str[10];
// 接收一个字符串函数
// 无返回值
void usart1_rec_str(u8 *str)
{

    while(1)
    {
        *str = usart1_rec_byte();
        if (*str == '#')
        {
            break;
        }
        str++;
    }

    *str = '\0';
}

```


### 中断

#### 中断服务函数格式
```
// 串口中断函数
void 函数名(void)
{

    // 如果是接收中断触发了，状态寄存器对应的
    {
        // 清除对应标志位
        // 执行事件
    }

    // 如果是空闲触发了中断， 判断状态寄存器对应的值，置 1
    {
        // 清除空闲标志位
        // 执行事件
    }
}

// 中断服务函数
void 函数名称(void)
{
    // 判断中断的信号类型，以及对应的标志位 满足
    {
        // 清除对应的标志位
        // 执行紧急事件
    }
}

```

#### 外部中断
```
总计思路
EXTI配置
{
    // GPIO 初始化
    // NVIC 初始化
    // 外部中断初始化
}
EXTI中断服务函数
{

}

具体思路
EXTI配置
{
    /* GPIO 初始化 */
    // 端口时钟使能
    // 端口模式寄存器 通用输入
    // 端口上下拉配置器 无上下拉

    /* NVIC 初始化 */
    // NVIC 优先级组配置
    // 优先级编码值计算
    // 确认中断源
    // 使能NVIC中断源响应通道

    /* 外部中断线初始化 */
    // 系统配置控制器时钟使能
    // 根据对应的GPIO口，配置映射到具体的中断线上
    // 上升沿或者下降沿配置 - 触发器设置
    
    // 中断屏蔽寄存器 - 使能中断线
}

中断服务函数
{
    /* 外部中断函数实现 */
    // 判断是那根EXTI线触发 读取-挂起寄存器
    {
        // 清标志位 
    }
    // 紧急事件
}
```


#### 延时思路
```
延时
{
    // 选择时钟源
    // 写入重载值（需要计数的数） 记得减1
    // 使能计数器
    // 清空当前值寄存器
    // 读取寄存器16号位，自动置1
    // 关闭定时器
}
```

#### 通用定时器延时思路
```
初始化延时定时器
{
    // 开启时钟使能 APB1
    /* 控制寄存器CR1 */ 
    // 自动重载使能 7位 影子寄存器
    // 计数器单次还是循环 3号位
    // 更新请求源使能 2位 是否配置中断
    // 是否配置更新事件 1号位 0 是
    // 预分频器 写入值 减 1.
    // 自动重载寄存器 
    // 事件生成寄存器 （手动更新）
    // 状态寄存器清0.
    // 计数使能 0位
    // 等待状态寄存器置 1 
}
```


#### 通用定时器定时中断思路
```
初始化思路
{
    // 开启时钟使能 APB1
    /* 控制寄存器 CR1 */
    // 重载预装载使能 7号位（影子寄存器）
    // 单次还是循环 3号位 写0
    // 更新请求源（中断）2号位 写0
    // 更新使能，1号位，写0.
    // 中断使能寄存器 DIER 8号位 置1
    // 预分频器 PSC, 需要减1
    // 状态寄存器清0.
    // 自动重载寄存器，需要减1.
    // 事件生成器（手动更新）EGR 写1
    // 计数使能 0位
}

中断服务函数
{
    // 清除标志位。
    // 读取状态寄存器的值 
    // 紧急事件
}
```
