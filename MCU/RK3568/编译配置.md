#### 脚本目录

```
/output/rootfs/target/etc/network  修改配置文件
/buildroot/board/rockchip/rk3566_rk3568/fs-overlay/etc/init.d/  自启动脚本目录
```



#### 波特率

1500000

#### 编译

```
加载默认配置
make ARCH=arm64 rockchip_linux_defconfig

make ARCH=arm64 menuconfig

修改保存到.config后要覆盖保存回原来的defconfig文件
make ARCH=arm64 savedefconfig

用新生成的defconfig覆盖原来的默认配置
cp defconfig arch/arm64/configs/rockchip_linux_defconfig

./build.sh
// 
make savedefconfig

Buildroot

make rockchip_rk3568_defconfig
make menuconfig

复制到 开发板文件
adb push 01_test /code

```





#### Kernel

RK_BOOT_FIT_ITS=/home/yxw/myproject/rk356x_linux5.1/device/rockchip/.chip/boot.its
RK_BOOT_IMG=boot.img
RK_BUILDROOT=y
RK_BUILDROOT_CFG=rockchip_rk3568
RK_CHIP=rk3568
RK_CHIP_FAMILY=rk3566_rk3568
RK_DEBIAN=y
RK_DEBIAN_ARCH=arm64
RK_DEBIAN_BULLSEYE=y
RK_DEBIAN_VERSION=bullseye
RK_DEFCONFIG=/home/yxw/myproject/rk356x_linux5.1/device/rockchip/.chips/rk3566_rk3568/rockchip_rk3568_evb1_ddr4_v10_defconfig
RK_EXTRA_PARTITION_NUM=2
RK_EXTRA_PARTITION_STR=oem:oem:/oem:ext4:defaults:normal:auto:@userdata:userdata:/userdata:ext4:defaults:normal:auto:@@@
RK_KERNEL=y
RK_KERNEL_ARCH=arm64
RK_KERNEL_CFG=rockchip_linux_defconfig
RK_KERNEL_DTB=kernel/arch/arm64/boot/dts/rockchip/rk3568-evb1-ddr4-v10-linux.dtb
RK_KERNEL_DTS=kernel/arch/arm64/boot/dts/rockchip/rk3568-evb1-ddr4-v10-linux.dts
RK_KERNEL_IMG=kernel/arch/arm64/boot/Image
RK_KERNEL_KBUILD_ARCH=host
RK_KERNEL_VERSION=5.10
RK_KERNEL_VERSION_REAL=5.10
RK_LOADER=y
RK_MISC=y
RK_MISC_BLANK=y
RK_OWNER=yxw
RK_OWNER_UID=1000
RK_PARAMETER=parameter-buildroot-fit.txt
RK_RECOVERY=y
RK_RECOVERY_CFG=rockchip_rk3568_recovery
RK_RECOVERY_FIT_ITS=/home/yxw/myproject/rk356x_linux5.1/device/rockchip/.chip/boot4recovery.its
RK_RECOVERY_INITRD_TYPE=cpio.gz
RK_ROOTFS=y
RK_ROOTFS_ASYNC_COMMIT=y
RK_ROOTFS_DEBUG_INFO=y
RK_ROOTFS_IRQBALANCE=y
RK_ROOTFS_OVERLAY=y
RK_ROOTFS_STRIP_MODULES=y
RK_ROOTFS_SYSTEM=buildroot
RK_ROOTFS_TYPE=ext4
RK_ROOTFS_UDEV_RULES=y
RK_SAVE_TRACKED=y
RK_SESSION=2025-08-06_19-26-30
RK_UBOOT_ARCH=arm64
RK_UBOOT_CFG=rk3568
RK_UPDATE=y
RK_USB_ADBD=y
RK_USB_ADBD_BASH=y
RK_USB_ADBD_TCP_PORT=5555
RK_USE_FIT_IMG=y
RK_WIFIBT_CHIP=ALL_AP
RK_YOCTO=y
RK_YOCTO_CHROMIUM=y
RK_YOCTO_DISPLAY_PLATFORM=wayland
RK_YOCTO_MACHINE=rockchip-rk3568-evb
RK_YOCTO_USBMOUNT=y

Toolchain for kernel:
/home/yxw/myproject/rk356x_linux5.1/prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-

==========================================
          Start building kernel
==========================================
+ make -C /home/yxw/myproject/rk356x_linux5.1/kernel/ -j9 CROSS_COMPILE=/home/yxw/myproject/rk356x_linux5.1/prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- ARCH=arm64 rockchip_linux_defconfig

```
export CROSS_COMPILE=/home/yxw/myproject/rk356x_linux5.1/prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-
 
make ARCH=arm64 rockchip_linux_defconfig
make ARCH=arm64 rk3568-evb1-ddr4-v10-linux.img -j16

救砖模式
	地线连接靠边的刮开的铜线 连接一起
	

* * *
* * *
* *
从左到右顺序
1 => otg 切换
2 => 重启

// 要开启
&sdhci {
	bus-width = <8>;
	no-sdio;
	no-sd;
	non-removable;
	max-frequency = <200000000>;
	full-pwr-cycle-in-suspend;
	status = "okay";
};

```



#### 手动设置GPIO状态

```
cat /sys/kernel/debug/gpio

cat /sys/kernel/debug/pinctrl/pinctrl-rockchip-pinctrl/pinmux-pins

cat /sys/kernel/debug/pinctrl/pinctrl-rockchip-pinctrl/pinmux-functions

cat /sys/kernel/debug/pinctrl/pinctrl-rockchip-pinctrl/pinconf-pins

cat /proc/device-tree/gpio0_b0/compatible 查看设备节点。设置复用关系是否存在。

ls /dev/ds18b20 检查是否创建节点

ls /sys/class/sensors/ds18b20 检查是否创建 类

cat /proc/devices/  检查设备号


例如：

GPIO1_A4 → 1×32 + 4 = 36

GPIO2_D3 → 2×32 + 24 + 3 = 83

操作步骤：
# 导出 GPIO
echo 97 > /sys/class/gpio/export

# 设置为输出模式
echo out > /sys/class/gpio/gpio97/direction

# 输出高电平
echo 1 > /sys/class/gpio/gpio97/value

# 输出低电平
echo 0 > /sys/class/gpio/gpio97/value

-------------------------------------------------
echo 113 > /sys/class/gpio/export

# 设置为输出模式
echo out > /sys/class/gpio/gpio113/direction

# 输出高电平
echo 1 > /sys/class/gpio/gpio113/value

# 输出低电平
echo 0 > /sys/class/gpio/gpio113/value

cat /sys/class/gpio/gpio113/value

-------------------------------------------------

# 取消导出
echo 97 > /sys/class/gpio/unexport

echo 1 > /sys/bus/pci/rescan

// 查看时钟配置
cat /sys/kernel/debug/clk/clk_summary | grep pcie


查看 DTS 已被内核解析的 reg/clocks：

# 找到 pcie 节点对应的 /proc/device-tree 节点
hexdump -C /proc/device-tree/pcie@fe260000/reg  # 二进制查看
# or
grep -R "pcie" /proc/device-tree -n

  https://kqvc3a7fuom.feishu.cn/wiki/TwfXwc8uSiDPqskWLLKcVnHXnif 
  https://kqvc3a7fuom.feishu.cn/wiki/GJo0wKUoGiRRBqkkp42cSUAznAg
```



#### 命令

```
时钟下标文件
include/dt-bindings/clock/rk3568-cru.h
```





#### make menuconfig

make -C /home/yxw/myproject/rk356x_linux5.1/kernel/ -j9 CROSS_COMPILE=/home/yxw/myproject/rk356x_linux5.1/prebuilts/gcc/linux-x86/aarch64/gcc-arm-10.3-2021.07-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu- ARCH=arm64 rockchip_linux_defconfig

kdir -p /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog
make CC="gcc" HOSTCC="gcc" \
    obj=/home/yxw/myproject/rk356x_linux5.1/output/kconf -C /home/yxw/myproject/rk356x_linux5.1/device/rockchip/common/kconfig -f Makefile.br mconf
make[1]: Entering directory '/home/yxw/myproject/rk356x_linux5.1/device/rockchip/common/kconfig'
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c lxdialog/checklist.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/checklist.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c lxdialog/inputbox.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/inputbox.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c lxdialog/menubox.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/menubox.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c lxdialog/textbox.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/textbox.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c lxdialog/util.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/util.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c lxdialog/yesno.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/yesno.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   -c mconf.c -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/mconf.o
gcc -D_DEFAULT_SOURCE -D_XOPEN_SOURCE=600 -DCURSES_LOC="<ncurses.h>" -DNCURSES_WIDECHAR=1 -DLOCALE  -I/home/yxw/myproject/rk356x_linux5.1/output/kconf -DCONFIG_=\"\"   /home/yxw/myproject/rk356x_linux5.1/output/kconf/mconf.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/zconf.tab.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/checklist.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/util.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/inputbox.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/textbox.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/yesno.o /home/yxw/myproject/rk356x_linux5.1/output/kconf/lxdialog/menubox.o -lncursesw -ltinfo -o /home/yxw/myproject/rk356x_linux5.1/output/kconf/mconf
make[1]: Leaving directory '/home/yxw/myproject/rk356x_linux5.1/device/rockchip/common/kconfig'

*** End of the configuration.
*** Execute 'make' to start the build or try 'make help'.



Buildroot

```
GEN     /home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/Makefile
/home/yxw/myproject/rk356x_linux5.1/buildroot/build/parse_defconfig.sh /home/yxw/myproject/rk356x_linux5.1/buildroot/configs/rockchip_rk3568_defconfig /home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/.config.in
Parsing defconfig: /home/yxw/myproject/rk356x_linux5.1/buildroot/configs/rockchip_rk3568_defconfig
Using /home/yxw/myproject/rk356x_linux5.1/buildroot/configs/rockchip_rk3568_defconfig as base
#
# merged configuration written to /home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/.config.in (needs make)
#
BR2_DEFCONFIG='' 
KCONFIG_AUTOCONFIG=/home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/build/buildroot-config/auto.conf KCONFIG_AUTOHEADER=/home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/build/buildroot-config/autoconf.h KCONFIG_TRISTATE=/home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/build/buildroot-config/tristate.config BR2_CONFIG=/home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/.config HOST_GCC_VERSION="9" BASE_DIR=/home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568 SKIP_LEGACY= CUSTOM_KERNEL_VERSION="5.10" BR2_DEFCONFIG=/home/yxw/myproject/rk356x_linux5.1/buildroot/configs/rockchip_rk3568_defconfig /home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/build/buildroot-config/conf 
--defconfig=/home/yxw/myproject/rk356x_linux5.1/buildroot/output/rockchip_rk3568/.config.in Config.in

```



#### 影响电源控制

```
pmu: power-management@fdd90000 {
		compatible = "rockchip,rk3568-pmu", "syscon", "simple-mfd";
		reg = <0x0 0xfdd90000 0x0 0x1000>;

		power: power-controller {
			compatible = "rockchip,rk3568-power-controller";
			#power-domain-cells = <1>;
			#address-cells = <1>;
			#size-cells = <0>;
			status = "okay";

			/* These power domains are grouped by VD_NPU */
			pd_npu@RK3568_PD_NPU {
				reg = <RK3568_PD_NPU>;
				clocks = <&cru ACLK_NPU_PRE>,
					 <&cru HCLK_NPU_PRE>,
					 <&cru PCLK_NPU_PRE>;
				pm_qos = <&qos_npu>;
			};
			/* These power domains are grouped by VD_GPU */
			pd_gpu@RK3568_PD_GPU {
				reg = <RK3568_PD_GPU>;
				clocks = <&cru ACLK_GPU_PRE>,
					 <&cru PCLK_GPU_PRE>;
				pm_qos = <&qos_gpu>;
			};
			/* These power domains are grouped by VD_LOGIC */
			pd_vi@RK3568_PD_VI {
				reg = <RK3568_PD_VI>;
				clocks = <&cru HCLK_VI>,
					 <&cru PCLK_VI>;
				pm_qos = <&qos_isp>,
					 <&qos_vicap0>,
					 <&qos_vicap1>;
			};
			pd_vo@RK3568_PD_VO {
				reg = <RK3568_PD_VO>;
				clocks = <&cru HCLK_VO>,
					 <&cru PCLK_VO>,
					 <&cru ACLK_VOP_PRE>;
				pm_qos = <&qos_hdcp>,
					 <&qos_vop_m0>,
					 <&qos_vop_m1>;
			};
			pd_rga@RK3568_PD_RGA {
				reg = <RK3568_PD_RGA>;
				clocks = <&cru HCLK_RGA_PRE>,
					 <&cru PCLK_RGA_PRE>;
				pm_qos = <&qos_ebc>,
					 <&qos_iep>,
					 <&qos_jpeg_dec>,
					 <&qos_jpeg_enc>,
					 <&qos_rga_rd>,
					 <&qos_rga_wr>;
			};
			pd_vpu@RK3568_PD_VPU {
				reg = <RK3568_PD_VPU>;
				clocks = <&cru HCLK_VPU_PRE>;
				pm_qos = <&qos_vpu>;
			};
			pd_rkvdec@RK3568_PD_RKVDEC {
				clocks = <&cru HCLK_RKVDEC_PRE>;
				reg = <RK3568_PD_RKVDEC>;
				pm_qos = <&qos_rkvdec>;
			};
			pd_rkvenc@RK3568_PD_RKVENC {
				reg = <RK3568_PD_RKVENC>;
				clocks = <&cru HCLK_RKVENC_PRE>;
				pm_qos = <&qos_rkvenc_rd_m0>,
					 <&qos_rkvenc_rd_m1>,
					 <&qos_rkvenc_wr_m0>;
			};
			pd_pipe@RK3568_PD_PIPE {
				reg = <RK3568_PD_PIPE>;
				clocks = <&cru PCLK_PIPE>;
				pm_qos = <&qos_pcie2x1>,
					 <&qos_pcie3x1>,
					 <&qos_pcie3x2>,
					 <&qos_sata0>,
					 <&qos_sata1>,
					 <&qos_sata2>,
					 <&qos_usb3_0>,
					 <&qos_usb3_1>;
			};
		};
	};
```



#### 编译配置文件

```
配置空间的大小位置。
SDK/device/rockchip/rkxxxx/parameter-buildroot.txt文件
```

![image-20251103095906015](D:\WorkSpace\learning-record\MCU\RK3568\编译配置.assets\image-20251103095906015.png)





```

```

