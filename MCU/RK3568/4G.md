#### 验证方法

```
使用 模式 配置网卡模式 cmnet
用的是 USB 接口

```





#### RM520N-GL

```
指令：
ip link show
ifconfig -a

AT+QCFG="usbnet",2配置网卡
接口类型为MBIM

使用 CuteCom 

检查是否编译驱动
	lsmod | grep mbim
	ls /dev/ttyUSB*
	ls /dev/cdc-wdm*
	ip link
	
确认模块支持 5G
	AT+CGMM
	AT+CGMR
打开 5G / NR（示例：Quectel）
	AT+QNWPREFCFG="mode_pref",AUTO
	AT+QNWPREFCFG="nr5g_disable",0
查询：
	AT+QNWPREFCFG="mode_pref"
等待网络注册（核心）
	AT+CEREG?
	返回含义：+CEREG: 0,1   ← 已注册 +CEREG: 0,5   ← 漫游已注册
	❌ 如果一直 0,2 / 0,0 → 没注册成功，数据一定起不来

确认当前是否 5G（非常关键）
	AT+QNWINFO
	理想返回：+QNWINFO: "NR5G","46000","NR5G-SA",78
	
模式： 
	qmi_wwan 驱动
	GobiNet 
	USB 转串口 option 驱动程序后，在/dev 目录下创建 ttyUSB0、 ttyUSB1 和 ttyUSB2 等设备文件。


```





#### 基础知识

```
通信接口有 UART 和 USB 

USB 
	接口有 USB_DP 差分线D+ USB_DM 差分线D- USB_VBUS USB电源输入  GND 地线
	RNDIS模式：windows 先常用模式
	ECM 模式。定义如何在 USB 上传输“以太网数据帧”的一种方式（即让 USB 设备像一张网卡）
	NCM 模式: 优化了ECM 在USB 传输数据的，可以发送多个包，合并成一个包。
	
5G 模式
	USB 驱动包括 USB 串口驱动（option 和 ACM）和 USBNet 驱动（GobiNet、
	QMI_WWAN、 MBIM、 NCM、 RNDIS 和 ECM）
	
接入点名称 
	ims CMNET CMWAP SOS 分别是什么
	
	
Linux 目录
	Ubuntu 编译后驱动 /lib/modules/6.8.0-88-generic/kernel/drivers/usb/serial/
	内核配置文件： /boot/config-$(uname -r) .config
	
指令模式：
	执行 AT+QCFG="usbnet",5 配置网卡拨号方式及驱动类型为 NCM；
	或者执行 AT+QCFG="usbnet",1 配置网卡拨号方式及驱动类型为 ECM；
	或者执行 AT+QCFG="usbnet",2 配置网卡拨号方式及驱动类型为 MBIM；
	或者执行 AT+QCFG="usbnet",3 配置网卡拨号方式及驱动类型为 RNDIS。

	执行 AT+QCFG="nat",0 配置拨号模式为网卡模式；
	或者执行 AT+QCFG="nat",1 配置拨号模式为路由模式；
	或者执行 AT+QCFG="nat",2 配置拨号模式为网桥模式。
	
PPP 指令：
	Quectel_UMTS_LTE_5G_Linux_USB_Driver_用户指导_V1.0.pdf
	AT 指令文档 Quectel_RG200U&Rx500U系列_AT命令手册_V1.0.pdf
	模式：Quectel_RG200U-CN&Rx500U-CN_网卡拨号应用指导_V1.1.pdf
	参考文档：RXX00U在Linux移植和拨号操作文档.pdf
```



#### 记录

```
1. 安装好系统后。编译安装 CuteCom 工具
2. 安装 搜狗输入法  apt install fcitx 
3. 安装 vscode 编辑器
4. 安装 chrome 浏览器 
5. 安装 snipaste 截图工具
6. 移动的文件有 驱动和拨号工具两种方式
```



![image-20251218095832181](D:\WorkSpace\Git\learning-record\MCU\RK3568\4G.assets\image-20251218095832181.png)



![image-20251218184030890](D:\WorkSpace\Git\learning-record\MCU\RK3568\4G.assets\image-20251218184030890.png)





![image-20251218183930775](D:\WorkSpace\Git\learning-record\MCU\RK3568\4G.assets\image-20251218183930775.png)





#### 工具PPP拨号

```
修改的对应的文件有 拨号的 
	命令：pppd call quectel-ppp &
	

+QUSIM:1
+QIND: SMS DONE
+QIND: PB DONE 
+CIEV:2,0

```



#### 安装的系统

```
ubuntu 安装的时候，插上了5G 模块， ubuntu 内核版本是 5.19.0 系统版本 22.04.2 测试的5G 模组 型号：RM520N-GL
	对应的结果是：使用系统编译安装好后的5G模组，插上天线后，使用 ppp 拨号，前提需要设置成 AT+QCFG="usbnet",2 MBIM 模式
	电脑右上角显示的是 手机信号。
	使用 串口工具 cutecom 拨号失败，但是设置模式是成功的。 
	使用 busybox microcom /dev/ttyUSB3 接口
	
ubuntu 安装的时候，插上了 4G 手机卡， ubuntu 内核版本是 6.8.0-90 系统版本 22.04.2 测试的5G 模组 （有两个版本的内核）
	使用模组型号：RM500U-CNV 但是编译了驱动代码，并 make install 到驱动目录中。最早的内核驱动是不能工作的。
	使用拨号方式 1， 驱动类型 ECM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 3， 驱动类型 RNDIS 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 5， 驱动类型 NCM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	
	
ubuntu 安装的时候，插上了 RM500U-CNV模块， ubuntu 内核版本是 5.19.0 系统版本 22.04.2 测试的5G 模组 
	使用模组型号：RM500U-CNV 内核自带的驱动 就能上网
	使用拨号方式 1， 驱动类型 ECM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 3， 驱动类型 RNDIS 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 5， 驱动类型 NCM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来 默认 
	使用拨号方式 2， 驱动类型 MBIM 拨号模式 0 网卡模式 开机可以上网，图标能正常显示出来了 重启之后，能自动链接并上网。
	
	
ubuntu 安装的时候，插上了 RM500U-CNV模块， ubuntu 内核版本是 6.8.0-90 系统版本 22.04.2 测试的5G 模组 
	插上网线，插上5G 模组 ，不要插上手机卡。
	使用模组型号：RM500U-CNV 内核自带的驱动 就能上网  有 /dev/ttyUSBN 端口号
	使用拨号方式 1， 驱动类型 ECM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 3， 驱动类型 RNDIS 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 5， 驱动类型 NCM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来 默认 
	使用拨号方式 2， 驱动类型 MBIM 拨号模式 0 网卡模式 开机可以上网，图标能正常显示出来了 重启之后，能自动链接并上网。
	
ubuntu 安装的时候, 5G模组没有插，手机卡没有插，安装时候没有更新软件 ubuntu 内核版本是 5.19.0 系统版本 22.04.2 测试的5G 模组 
	使用模组型号：RM500U-CNV 内核自带的驱动 就能上网 默认是 2 模式 但是可以上网，开机就能上网了。
	使用拨号方式 1， 驱动类型 ECM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 3， 驱动类型 RNDIS 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来
	使用拨号方式 5， 驱动类型 NCM 拨号模式 0 网卡模式 开机可以上网，但是图标显示不出来 默认 
	使用拨号方式 2， 驱动类型 MBIM 拨号模式 0 网卡模式 开机可以上网，图标能正常显示出来了 重启之后，能自动链接并上网。
```





按照网上的文章，直接修改的是/etc/resolv.conf ，原文内容如下：

nameserver 127.0.0.53
options edns0 trust-ad
直接添加新的dns，例如：

nameserver 8.8.8.8
nameserver 114.114.114.114
结果reboot重启之后，还是原来的内容不变，仔细查看才发现/etc/resolv.conf本身在第一行的注释里面已经写了“Do not edit"。经过查阅相关资料，找到如下方法可以修改Ubuntu20.04 LTS版本的DNS，

首先修改 /etc/systemd/resolved.conf 文件，在其中添加dns信息，例如：

DNS=8.8.8.8 114.114.114.114
然后退出保存。

然后以root身份在ubuntu终端中依次执行如下命令：

systemctl restart systemd-resolved
systemctl enable systemd-resolved

mv /etc/resolv.conf /etc/resolv.conf.bak
ln -s /run/systemd/resolve/resolv.conf /etc/
再查看/etc/resolv.conf文件就可以看到新的dns信息已经写入其中了。



###### 查看哪个进程占用了该设备
sudo fuser /dev/ttyUSB2

###### 强制杀死占用进程
sudo fuser -k /dev/ttyUSB2

###### 或者用更强制的方式
sudo fuser -k -9 /dev/ttyUSB2



nmcli device 命令 



#### 系统区分

```
ubuntu 22.4.2 测试5G 02 (6.8.0内核)，安装系统的时候，插上了网线，更新了内核

```

