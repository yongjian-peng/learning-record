###### 过程

确定mac，gmac，mdio

修改phy复位脚

选择时钟clock_in_out

修改电源1.8v



###### 命令

`ls /sys/bus/mdio_bus/devices`

​	stmmac-0:00  stmmac-1:00

​	0和1代表的是phy芯片的地址



`root@rk3568-buildroot:/sys/bus/mdio_bus/devices/stmmac-0:00# cat phy_registers`

​	查看寄存器地址



`root@rk3568-buildroot:/sys/bus/mdio_bus/devices/stmmac-0:00# echo 0x00 0x40 > phy_registers`

​	对0号寄存器写入0x40

ip link set eth0 up



###### ip配置

ethtool

```
vi /etc/network/interfaces
```

```
# 1. 清除可能残留的旧IP（若有）
ip addr flush dev eth0

# 2. 设置与电脑同网段的IP（192.168.1.x，x可设为100，避免与电脑的192.168.1.7冲突）
ip addr add 192.168.1.100/24 dev eth0

# 3. 设置与电脑相同的网关（192.168.1.1）
ip route add default via 192.168.1.1 dev eth0

# 4. 确保DNS配置正确（之前已设置，可重新确认）
echo "nameserver 8.8.8.8" > /etc/resolv.conf
echo "nameserver 114.114.114.114" >> /etc/resolv.conf


ping 192.168.1.7  # 电脑的IP地址
ping 192.168.1.1  # 网关IP
ping 8.8.8.8
ping www.baidu.com


# 先恢复自动协商，测试是否更稳定
ethtool -s eth0 autoneg on

# 若仍不稳定，尝试强制100Mbps全双工（兼容性更好）
ethtool -s eth0 speed 100 duplex full autoneg off

ethtool -S eth0 | grep -i error

# 尝试访问网关管理页面（HTTP）
wget 192.168.1.1  # 若返回"Connecting to 192.168.1.1..."，说明能连接网关


# 重新配置DNS（使用国内更稳定的DNS）
echo "nameserver 223.5.5.5" > /etc/resolv.conf
echo "nameserver 223.6.6.6" >> /etc/resolv.conf

# 直接用IP测试百度（绕过DNS解析）
ping 183.2.172.17  # 百度IP（从之前的输出获取）
ping www.baidu.com
```



tmp 目录中没有 resolv.conf

```
bash -c 'cat > /etc/resolv.conf <<EOF
nameserver 8.8.8.8
nameserver 1.1.1.1
EOF'
```





###### 在sdk中配置IP和dns


```
auto eth0
iface eth0 inet static
address 192.168.1.100
netmask 255.255.255.0
gateway 192.168.1.1
dns-nameservers 8.8.8.8 114.114.114.114
source-directory /etc/network/interfaces.d
```




```
#!/bin/sh

# 确保resolv.conf存在且正确
setup_dns() {
    if [ ! -e /etc/resolv.conf ] || ! grep -q "nameserver" /etc/resolv.conf; then
        echo "Setting up DNS configuration..."
        echo "nameserver 8.8.8.8" > /etc/resolv.conf
        echo "nameserver 114.114.114.114" >> /etc/resolv.conf
        echo "options timeout:1 attempts:1" >> /etc/resolv.conf
    fi
}

case "$1" in
    start)
        setup_dns
        ;;
    stop)
        ;;
    restart|reload)
        setup_dns
        ;;
    *)
        echo "Usage: $0 {start|stop|restart}"
        exit 1
        ;;
esac

exit 0

```

该目录下文件会直接拷贝到板上，rk3568开机启动时会读取该文件。

```
cat etc/init.d/S99dnsconfig
```

